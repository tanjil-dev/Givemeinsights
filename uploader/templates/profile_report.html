{% extends "base.html" %}
{% load static %}
{% block content %}
<style>
    table th {
        text-align: left !important;  /* Align table headers to the left */
    }
    p.text-body-secondary.text-end {
        display: none !important;
    }
</style>
<br><br><br><br><br>
<div class="container">
    <h2 class="mt-5">Upload Excel File for Data Profiling</h2><br>

    <!-- Form for uploading Excel file -->
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="mb-3">
            <input type="file" name="excel_file" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary">Generate</button>
    </form>

    {% if profile_report_html %}
    <hr>
    <h4 class="mt-4">Data Profile Report</h4>
    <div class="border p-3 bg-white" style="overflow-x: auto; max-height: 600px;">
        <div class="profile-report">
            {{ profile_report_html|safe }}
        </div>
    </div>
    <!-- Download Button -->
    <button id="download-button" class="btn btn-success mt-4">Download Report</button>
    {% endif %}
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const downloadButton = document.getElementById('download-button');
        const reportHtml = "{{ profile_report_html|escapejs }}"; // Get the HTML content from the backend

        downloadButton.addEventListener('click', function() {
            // Create a Blob with the HTML content
            const blob = new Blob([reportHtml], { type: 'text/html' });

            // Create a link element to simulate a download
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'data_profile_report.html';  // Name of the file

            // Programmatically click the link to trigger the download
            link.click();
        });
    });
</script>
{% endblock content %}
